# AIstoic コード品質分析レポート

## 概要

このレポートは、AIstoic（サンダー対メタグロス特化計算機）のコードベースに存在する問題点を包括的に分析したものです。

## 主要な問題点

### 1. useEffect の不適切な使用と lint エラー

#### 問題箇所

- `src/components/CustomMetagrossForm.tsx` (58-60 行目)
- `src/components/ThunderForm.tsx` (56-58 行目)

#### 詳細

- useEffect の依存配列が正しく設定されていない
- 無限ループのリスクがある実装
- Biome の lint エラーが発生している（useExhaustiveDependencies）

#### 推奨される修正

useEffect を削除し、値の変更時に直接 onSubmit を呼ぶか、submit ボタンを設置する

### 2. Biome エラーの放置

#### 検出されたエラー（計 10 件）

1. **型インポートの問題** (2 件)

   - `badge.tsx`: `import * as React` を `import type * as React` に変更すべき
   - `progress.tsx`: 同様の問題

2. **useEffect の依存配列問題** (6 件)

   - CustomMetagrossForm.tsx: 不足している依存関係と不要な依存関係
   - ThunderForm.tsx: 同様の問題

3. **コードスタイルの問題** (2 件)
   - `battle/index.ts`: `let`を`const`に変更可能な変数
   - `damage.test.ts`: 非推奨の non-null assertion (`!`)の使用

### 3. CLAUDE.md の不完全な記述

#### 問題

- テストや lint の実行がコマンドリストに明記されていない
- エージェントが品質チェックを行わずに「完成」と判断してしまう

#### 推奨される追加

```markdown
### 開発フロー

1. コード変更後は必ず以下を実行：
   - `npm run lint` - lint エラーがないことを確認
   - `npm run test` - テストが通ることを確認
   - `npm run build` - ビルドが成功することを確認
```

### 4. コンポーネント構造の問題

#### 未整理な点

- components フォルダ直下にメインコンポーネントが混在
- 機能別の整理が不十分

#### 推奨される構造例

```
components/
├── features/
│   ├── battle/
│   │   ├── BattleAnalysis.tsx
│   │   └── WinRateTable.tsx
│   ├── pokemon/
│   │   ├── ThunderForm.tsx
│   │   └── CustomMetagrossForm.tsx
│   └── damage/
│       └── DamageCalculation.tsx
├── common/
└── ui/
```

### 5. 未使用コードの存在

#### 未使用のインポート

#### 未使用の関数

#### 未使用のコンポーネント

### 6. 型アサーションの不適切な使用

#### 問題箇所

- `CustomMetagrossForm.tsx` (52 行目): `onSubmit(metagross as Metagross)`

#### 問題点

- `Omit<Metagross, 'item'>` を `Metagross` に強制変換
- TypeScript の型安全性を損なう実装

### 7. タイプ相性計算の過剰な汎用化

#### 現状の問題

- `calculateModifiers`関数でタイプ相性を汎用的に計算しているが、実際は固定値
- サンダー（でんき/ひこう）、メタグロス（はがね/エスパー）、10 まんボルト（でんき）、いわなだれ（いわ）のタイプは不変

#### 現在のコード（過剰に汎用的）

```typescript
const typeEffectiveness =
  moveType === "rock" && "electricMove" in defender ? 2.0 : 1.0;
```

#### 推奨される簡潔な実装

```typescript
// いわなだれ→サンダーは2倍、それ以外は等倍（固定）
const typeEffectiveness = moveType === "rock" ? 2.0 : 1.0;
```

## 改善の優先順位

### 高優先度

1. Biome エラーの修正（特に useEffect 関連）
2. CLAUDE.md への品質チェックプロセスの追記
3. 型アサーションの除去

### 中優先度

4. 未使用コード・インポートの削除
5. タイプ相性計算の簡潔化
6. コンポーネントフォルダの再構成

### 低優先度

7. その他のコードスタイルの改善

## まとめ

現在のコードベースは機能的には動作するものの、保守性と品質の観点から複数の改善点が存在します。特に lint エラーの放置と useEffect の不適切な使用は、将来的なバグの温床となる可能性があるため、早急な対処が推奨されます。
